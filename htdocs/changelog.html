<HTML>
<HEAD>
  <!-- Created with AOLpress/2.0 -->
  <!-- AP: Created on: 27-Aug-2002 -->
  <!-- AP: Last modified: 4-Jun-2003 -->
  <TITLE>Change log for PfaEdit</TITLE>
</HEAD>
<BODY>
<H1 ALIGN=Center>
  <A NAME="change-log">Changes</A> <SMALL>(Enhancements &amp; Bug Fixes)</SMALL>
</H1>
<UL>
  <LI>
    4-Jun-2003
    <UL>
      <LI>
	Added a Shadow effect
      <LI>
	More fixes for remove overlap
      <LI>
	fixed a bug with timers
      <LI>
	Preserve the Fit To Em mode of a font.
      <LI>
	Added a bunch of scripts (as in writing systems, not executable files) from
	the proposed ISO 15924 standard.
      <LI>
	Added support for underline position to bdf files.
      <LI>
	The 18-May build was bad and failed to read postscript fonts properly on
	many platforms (the sources were ok, but the builds were bad)
      <LI>
	Display the version number in the about box, and attach it to the directory
	in the source .tgz file.
    </UL>
  <LI>
    18-May-2003
    <UL>
      <LI>
	PfaEdit would crash when asked to produce a ttf font where there was an unused
	anchor class.
      <LI>
	The original encoding is now preserved when a font is generated.
      <LI>
	The goto dialog (and scripting) now recognize "glyph&lt;nnn&gt;" as refering
	to glyph &lt;nnn&gt; in the original encoding.
      <LI>
	Kanou provided two scripting commands, ConvertToCID and ConvertByCMap.
      <LI>
	Added a Remove External flag to Expand Stroke to complement Kanou's Remove
	Internal
      <LI>
	Expanded on Remove Overlap by adding
	<UL>
	  <LI>
	    Intersection -- which removes everything except the overlap
	  <LI>
	    Exclude -- which removes areas where any selected contours cross non-selected
	    contours (and then removes the selected contours)
	</UL>
      <LI>
	Added an Effects sub-menu of Elements, including (so far)
	<UL>
	  <LI>
	    Outline -- turns the selected characters into outline versions of themselves
	  <LI>
	    Inline -- turns the selected characters into inline versions of themselves
	</UL>
      <LI>
	PfaEdit would crash when reading in an sfd file containing a kerning class
      <LI>
	gimp objected to some of my ttf fonts. I think because it is inappropriately
	clipping to the ascent/descent values in the hhea rather than using the font's
	bounding box. It's easy enough to preserve the 'hhea' ascent/descent values
	and perhaps that will be enough to make gimp happy.
      <LI>
	Kanou points out that rasterization has problems with the new TOfNextMajor,
	so use the new code for remove overlap and friends and the old code for
	rasterization
    </UL>
  <LI>
    12-May-2003
    <UL>
      <LI>
	Added a command to do non-linear transformations (but made it require user
	configuration to have it compiled)
      <LI>
	Added a UI for Kanou's Remove Internal flag to Expand stroke
    </UL>
  <LI>
    9-May-2003
    <UL>
      <LI>
	Apple's 'lcar' (ligature caret) table was being generated incorrectly
      <LI>
	Another bug in point numbering
      <LI>
	Make "Slanted" a synonym for Oblique.
    </UL>
  <LI>
    8-May-2003
    <UL>
      <LI>
	PfaEdit did not recognize "filename(fontname)" notation for loading a specific
	font from a resource fork of a mac file.
      <LI>
	PfaEdit crashed on the mac when generating a GPOS table. There was an
	uninitialized variable there, left behind be recent changes. Removed.
    </UL>
  <LI>
    7-May-2003
    <UL>
      <LI>
	Oops. It should be legal for a 'mkmk' anchor class to have two points in
	a glyph, one the normal mark point, the other the base mark point. (that
	is it should be possible for a glyph to attach to itself).
      <LI>
	Kanou supplied a patch to extend expand stroke.
      <LI>
	Changed behavior of AnchorClasses so that two classes could be associated
	to form a single feature (ie. one class of "Above" marks, and one class of
	"Below" marks)
      <LI>
	Show ATT now displays something meaningful for marks
      <LI>
	Some general Anchor Class clean up.
      <LI>
	Was not setting bits in the CodePage[1] field of the OS/2 table for all the
	weird MS specific encodings. It seems I should do that.
    </UL>
  <LI>
    6-May-2003
    <UL>
      <LI>
	Although undocumented, digits behave just like lower case letters in macintosh
	filenames for postscript resource fonts. 
	  <HR>
      <LI>
	Looking at the font info-&gt;ttf values dialog would cause pfaedit to crash
	after [Ok] was pressed.
      <LI>
	Old sfd files with anchor classes but not script lang index would crash pfaedit
	when being read in.
    </UL>
  <LI>
    5-May-2003
    <UL>
      <LI>
	Made it possible to select kerning class 0 (ie. everything that isn't specified)
      <LI>
	Put in a check to make sure the user didn't add a glyph to two different
	kerning classes
      <LI>
	<FONT COLOR="Red"><STRONG>PfaEdit was dumping out a full GSUB sub-table for
	each character that sub-table applied to (rather than one sub-table for all
	characters). So there were tons of duplicates.</STRONG></FONT>
      <LI>
	<FONT COLOR="Red"><STRONG>PfaEdit was producing extension sub-tables that
	held an incorrect offset.</STRONG></FONT>
      <LI>
	Added some code to protect PfaEdit when it read incorrect ttf fonts like
	those generated above.
      <LI>
	Drag and Drop to the Char Info dlg was broken.
      <LI>
	If a font had a non-notdef character at encoding 0 and we used freetype to
	generate bitmaps for it, then those bitmaps would be assigned to the wrong
	glyphs (ie. the bitmap for "A" would go to "B", etc.)
      <LI>
	I used "Mac Roman" in several places where I should have said "Macintosh
	Latin"
    </UL>
  <LI>
    4-May-2003
    <UL>
      <LI>
	Added code to determine better defaults for the script lang index
      <LI>
	The ligature state table in Apple Chancery has so many possible paths through
	it that PfaEdit bogs down when evaluating it. I presume it would finish in
	finite time, but it takes unacceptably long. So I've put in an abort.
      <LI>
	Add support for KernClasses (ie. they are no longer just converted into a
	large number of kernpairs, but will be stored internally as a set class and
	will be output as such). And they have their own dialogs to manage them.
      <LI>
	Add support for Apple's new version of the 'kern' table.
      <LI>
	Add support for the format 2 sub table of Apple's 'kern' table (which is
	different from OpenType's format 2 sub-table of the kern table), and is Apple's
	kerning class sub-table (note:
	<A HREF="http://developer.apple.com/fonts/TTRefMan/RM06/Chap6kern.html">Apple's
	docs </A>are
	<FONT COLOR="Red"><SMALL><STRONG>WRONG</STRONG></SMALL></FONT>. they claim
	class data are stored in an array of uint8, but they really are in an array
	of uint16).
    </UL>
  <LI>
    29-Apr-2003
    <UL>
      <LI>
	Oops, one more fix to remove overlap
      <LI>
	Kanou points out that copy hasn't been working (for some time now) when a
	contour has be split into bits, only one of the bits is copied.
      <LI>
	Kanou points out that Paste reorders open contours
      <LI>
	Further work on Show ATT dlg
      <LI>
	Further work on multiple features.
    </UL>
  <LI>
    28-Apr-2003
    <UL>
      <LI>
	Yet more fixes for Remove overlap
      <LI>
	Added a mode to the ruler tool where it shows the exact position of the mouse
	cursor
      <LI>
	The Goto command had a strange bug: If a font had a glyph with a known name,
	but that glyph did not reside at the unicode slot assigned to that name,
	then goingto that name would go to the (empty) unicode slot, rather than
	to the actually character.
      <LI>
	Werner wants a <A HREF="showatt.html">dlg</A> which shows collects all the
	GPOS/GSUB (morx/kern) information in one place rather than scattering it
	around hundreds of dlgs.
      <LI>
	PfaEdit now stores the script/langs for kern pairs
      <LI>
	PfaEdit failed to read script/langs for GPOS properly.
      <LI>
	PfaEdit had problems generating an AFM file from a CID font with ligatures
      <LI>
	PfaEdit had problems getting script lang lists right when multiple features
	refered to the same lookup.
    </UL>
  <LI>
    20-Apr-2003
    <UL>
      <LI>
	One of PfaEdit's deficiencies is that it handles multiple encodings for the
	same glyph very badly (it does not have the multiple layers of indirection
	that fonts do). Rather than solve this properly I have added a new command
	that allows for this case.
	<A HREF="editmenu.html#SameGlyphAs">SameGlyphAs</A>.
      <LI>
	Add some more synonyms for greek glyph names
      <LI>
	Failed to realize that U+1FED was an accent
      <LI>
	No longer tries to build greek accents out of latin ones when Build Accented
	is invoked. (but still will for Build Composit).
      <LI>
	When swapping character names, check for names like "uniXXXX" and instead
	of swapping it, rebuild it as appropriate for the other character.
      <LI>
	Font Info-&gt;Encoding failed to change the encoding properly when switching
	from "Compacted" to anything other than the original encoding.
      <LI>
	A couple of changes to the italian translation
      <LI>
	Added an "Original" encoding which gives you back the ordering of the glyphs
	in the ttf font. (this may be changed when you regenerate a ttf font)
      <LI>
	PfaEdit failed to read ttf instructions for composit glyphs.
      <LI>
	PfaEdit got confused if a ttf file had multiple glyphs named ".notdef" (which
	to me looks like a bug in the ttf font, but Times New Roman does this so
	I have to deal with it).
      <LI>
	Added a command to the popup menu in the charview to bring up a window looking
	at a reference.
      <LI>
	Add a check for when sfd files contain bad kerning info.
    </UL>
  <LI>
    14-Apr-2003
    <UL>
      <LI>
	Change a tab in Font Info from "PS General" to "General"
      <LI>
	When searching for encoding files, look for the extension ".enc" used by
	TeX for PostScript encoding files
      <LI>
	Fixed a crash when setting a character's name to a name already given to
	another character
      <LI>
	Added many new X resources for controlling colors in the outline character
	view.
    </UL>
  <LI>
    7-Apr-2003
    <UL>
      <LI>
	Program generated divide by zero errors when using Meta-Shift to move a control
	point which didn't exist.
      <LI>
	(cleaned up some syntax issues in non-English nomen files)
      <LI>
	Added new scripting commands ClearPrivateEntry, ChangePrivateEntry,
	GetPrivateEntry
      <LI>
	Added new scripting command: UnicodeFromName
      <LI>
	Added new script command: RemoveATT
      <LI>
	Vadim pointed out that loading "pala.ttf" and then generating it again (as
	ttf) produced bad results. PfaEdit was getting confused by the points which
	were used to control Anchors, getting its points list out of order and generally
	screwing up.
    </UL>
  <LI>
    04-Apr-2003
    <UL>
      <LI>
	autosave sometimes lost track of which font it should be applying changes
	to.t
      <LI>
	Add Extrema (or just adding a point in the middle of a spline) would generate
	incorrect splines if the spline were linear in one but not both of the two
	dimensions
      <LI>
	One more change to Merge/Simplify. Deal with the case of a curve point with
	no control point (use the control point in the opposite direction to get
	the slope).
      <LI>
	Typo in 2-Apr script/lang fix caused crashes.
      <LI>
	TeXBaseEncoding (T1) changed in Oct-2002. Updated my version (also updated
	the other TeX encodings I've got and included the cyrillic ones into
	Encodings.ps.gz)
      <LI>
	Sometimes we failed to remove the dot when creating a dotless i/j character.
      <LI>
	Merge/Simplify had caniptions when given a zero length spline.
      <LI>
	Added "DefaultATT" and "AddATT" scripting command to allow user to add Advanced
	Typography features to characters.
    </UL>
  <LI>
    2-Apr-2003
    <UL>
      <LI>
	Problems with script/lang when: Pasting or Merging ligatures and substitutions
	from one font to another
      <LI>
	PfaEdit could generate points (within a ttf simple glyph) in a different
	than the original glyph, meaning that the instructions would move the wrong
	point resulting in blots. I have fixed this (or at least the cases I found).
      <LI>
	PfaEdit would always give ASCII characters their standard names in a ttf
	post table. This was wrong if the character did not have its standard name.
      <LI>
	PfaEdit could go into an infinite loop on some simplifies.
    </UL>
  <LI>
    1-Apr-2003 (April Fish!)
    <UL>
      <LI>
	Fixed a crash in the Join command
      <LI>
	Fixed a crash when loading some truetype fonts (never bothered to figure
	which ones exactly)
      <LI>
	Fixed a similar crash when loading old sfd files (note some old fonts won't
	guess the script for ligatures, etc. properly)
      <LI>
	Added a new preference item: Stop At Join
      <LI>
	Changed the way control points are set when changing point type.
      <LI>
	The fill of the outline view sometimes lagged the change.
      <LI>
	Added another tag to CharInfo scripting command: GlyphIndex. It returns the
	glyph number in the ttf font.
      <LI>
	Werner suggests that instead of namint things "nounicode-%x" where %x is
	the encoding, use "nounicode-%d-%d-%x" where the two new arguments are the
	platform/specific pair used in the cmap we picked.
    </UL>
  <LI>
    31-Mar-2003
    <UL>
      <LI>
	PfaEdit was not reading pfb fonts properly if they had more than one binary
	section header.
      <LI>
	When PfaEdit removed a character it did not remove all the kernpairs that
	refered to that character.
      <LI>
	Fixed more leaks with valgrind.
      <LI>
	Added more synonyms for glyph names from Adobe Glyph List (I still rely on
	Glyph names for New Fonts as my basic set of names)
      <LI>
	PfaEdit had problems if the use selected 0 levels of undoes when the UI was
	active.
      <LI>
	Selecting the freehand tool in a quadratic font caused a crash. (The freehand
	tool doesn't work in quadratic fonts, but it shouldn't crash)
      <LI>
	Changed the way scripts are specified. I used to assign a script to every
	character. I realize that doesn't work. The digits are used in many scripts
	and the fraction ligatures based on them need to be seen in all those scripts,
	not just the one that the digit was assigned to. So...
	<UL>
	  <LI>
	    Glyphs no longer have a script assigned to them
	  <LI>
	    Substitutions, Ligatures, Anchor Classes and other Advanced Typographic features
	    now have a list of scripts (and languages) for which they are active.
	  <LI>
	    There is now an absurdly complex <A HREF="charinfo.html#Feature-Tag">stream
	    of dialogs</A> which may be used to set this list.
	</UL>
      <LI>
	Added a new preference item to allow the user to specify a local help directory
      <LI>
	Added a new scripting command SelectIf which allows you to determine whether
	a character is in a font (Select signals an error if the character isn't
	there, SelectIf returns failure).
      <LI>
	Added a new scripting command to change a font's order (from quadratic to
	cubic)
      <LI>
	ScaleToEm scripting command will now accept a single argument, the em-size.
      <LI>
	Added a new scripting command to allow you to apply an otf substitution to
	the font
      <LI>
	Added a new scripting command to give control over which ligatures are output
	in an afm file
	<UL>
	  <LI>
	    (it used to be that all ligatures were output in the afm file, no only 'liga'
	    and 'rlig' that appear in a default language are output)
	</UL>
      <LI>
	AFM files only support 2 character ligatures. So, when possible, generate
	a sort of closure on the ligatures. So if we are given the two ligs "ffi-&gt;f
	f i" and "ff-&gt;f f" then add the ligature "ffi-&gt;ff i". This means that
	the sequence f+f-&gt;ff+i-&gt;ffi will eventually reach the ligature we want.
      <LI>
	Changed so that an untitled anchor class is now called "Anchor-*" rather
	than "Untitled-*".
      <LI>
	Rewrote Merge &amp; Simplify commands. In my tests they now produce better
	results.
      <LI>
	Type2 font generation did not make use of hv/vh curveto commands in some
	cases
      <LI>
	When figuring out whether to synchronize the width/lbearing of a base character
	with the composits containing it, I only checked if the base character was
	alphabetic. But that doesn't work for hebrew where unicode says the marks
	are alphabetic. So add an additional check that it can't be a combining
	character.
      <LI>
	When pasting a composite character from one font to another, the saved width
	is not useful. Added a check that finds the correct width of the appropriate
	base character.
      <LI>
	When pasting a composite character from a font with one em-size to another
	with a different em-size try to scale the amount references are translated
	by an appropriate amount.
      <LI>
	CharInfo scripting command has been extended to allow users to test the presence
	of substitutions
      <LI>
	Some fonts (bsmi00lp.ttf for one) have bad cmap tables which map several
	glyphs to the same unicode code point. Put in a check for this and only map
	one glyph to that code point now.
    </UL>
  <LI>
    13-Mar-2003
    <UL>
      <LI>
	Add a preference item to control the number of undoes saved per character
      <LI>
	Turn off saving undoes when in a script started from the command line
      <LI>
	Added a preference item to control the undo depth from the UI.
      <LI>
	Try to do better about scaling my chunk allocator to machines with 8 byte
	pointers
      <LI>
	Was doing 32 bit arithmetic when reading GSUB simple substitution lookups
	when I should have done 16 bit.
      <LI>
	Tracked down a lot of memory leaks with valgrind (and some uninitialized
	variables too)
      <LI>
	Added access to a font's version from scripting
      <LI>
	Added PostNotice scripting command
      <LI>
	When reading a ttf/otf font with a GSUB table pfaedit will try to guess
	reasonable names for unnamed glyphs by looking them up in the GSUB table.
	Thus an unnamed vertical varient for "A" might be named "A.vrt2".
      <LI>
	PfaEdit would crash when outputting ttf files with no 'cvt' table (bug introduced
	around 27-Feb)
      <LI>
	the configure script did not respect the argument --with-freetype-src as
	it should have.
    </UL>
  <LI>
    10-Mar-2003
    <UL>
      <LI>
	Added a TrueType instruction debugger (actually an interface to FreeType's
	truetype bytecode interpreter)
	<TABLE BORDER CELLPADDING="6" WIDTH="50%" ALIGN=CENTER>
	  <TR>
	    <TD BGCOLOR="#ffff00">This command depend on your compiling freetype with
	      the byte code interpreter enabled. This is disabled by default because it
	      infringes on certain
	      <A HREF="http://freetype.sourceforge.net/patents.html">patents granted to
	      Apple</A>. If you have a license from Apple then you may enable the interpreter
	      by setting the appropriate macro in .../include/freetype/config/ftoption.h
	      before you build the library (see the README.UNX file on the top level of
	      the freetype distribution).
	      <P>
	      PfaEdit needs to have the freetype source directories available when it is
	      built (there are some include files there which it depends on)</TD>
	  </TR>
	</TABLE>
      <LI>
	Added an Edit-&gt;Copy Grid Fit command (to put the grid fit splines into
	the clipboard)
      <LI>
	Added a warning if the freetype library doesn't have a byte code interpreter
	so that the user knows his/her splines have been autohinted (rather than
	had the bytecode instructions run).
      <LI>
	Improved Edit-&gt;Merge in some cases that don't fit its constraints
      <LI>
	KANOU found some more underscores in character names
      <LI>
	And provided a new japanese ui
      <LI>
	Round to Int had problems on quadratic splines
      <LI>
	Added support for runtime loading of dynamic libraries on the mac.
    </UL>
  <LI>
    03-Mar-2003
    <UL>
      <LI>
	Memory got screwed up when converting TTF splines to PS ones
      <LI>
	KANOU suggested some changes to the quadratic spline UI
      <LI>
	I had the wrong makefile at top level so builds didn't
      <LI>
	syntax error on systems without freetype
    </UL>
  <LI>
    02-Mar-2003
    <UL>
      <LI>
	Changed the Show Instructions command to be an Edit Instructions
      <LI>
	Bug saving 'prep' table
      <LI>
	Bug changing 'cvt ' table
      <LI>
	Added ability to look at gridfit splines in charview.
    </UL>
  <LI>
    <A HREF="oldchangelog.html">Earlier Changes </A>
</UL>
</BODY></HTML>
