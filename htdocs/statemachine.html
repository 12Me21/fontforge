<HTML>
<HEAD>
  <!-- Created with AOLpress/2.0 -->
  <!-- AP: Created on: 27-Sep-2003 -->
  <!-- AP: Last modified: 27-Sep-2003 -->
  <TITLE>The Mac State Machine dialog</TITLE>
</HEAD>
<BODY>
<H1 ALIGN=Center>
  The Mac State Machine Dialog
</H1>
<P>
<IMG SRC="statemachine-context.png" WIDTH="490" HEIGHT="599" ALIGN="Right">The
mac uses state machines where opentype would use a contextual lookup. The
example at right (with appropriate substitutions attached to it) will convert
an initial or medial short-s into a long-s (for doing renaissance printing).
<P>
PfaEdit currently supports 3 types of state machines: contextual glyph
substitution, indic rearrangement, and contextual glyph insertion. The example
at right is of contextual glyph substitution.
<P>
All state machines have certain similar features. They must all be assigned
to a feature/setting combination, they all have a set of flags indicating
in what circumstances they apply, they all have the glyphs of the font assigned
to a set of classes, and finally they all have a series of transitions indicating
how each state behaves when given input from the specified class.
<P>
On the mac there are four predefined classes, one meaning the end of input,
one for all glyphs not specified elsewhere, one for the magic "deleted" glyph
(Apple does not always delete a glyph when asked to do so, instead it retains
a special mark in the glyph stream indicating that the glyph should be deleted
later), and finally a class for the end of a line of text. Any classes after
this are user defined. In the example at right there is one user defined
class and it contains the letters in the latin alphabet. Any other characters
in the font (the digits for example) will automatically be assigned to class
1 ("{Everything Else}").
<P>
The state machine itself is shown as a two dimensional matrix of transition,
one transition for every state and class. Classes are shown at the top of
the matrix, and states down the side. The transition from state 0 when given
input from class 0 is shown in the upper left corner of the matrix, and so
on.
<P>
When the state machine start up it will be in one of the first two states.
It will be in state 0 at the beginning of input, and in state1 when it starts
at the beginning of a new line.
<P>
The <A NAME="transitions">transitions</A> look slightly differently depending
on the type of state machine:
<TABLE BORDER CELLPADDING="2">
  <TR>
    <TH>Indic</TH>
    <TH>Contextual</TH>
    <TH>Insertion</TH>
  </TR>
  <TR>
    <TD><P ALIGN=Center>
      <IMG SRC="transition-indic.png" WIDTH="54" HEIGHT="64"></TD>
    <TD><P ALIGN=Center>
      <IMG SRC="transition-context.png" WIDTH="54" HEIGHT="64"></TD>
    <TD><P ALIGN=Center>
      <IMG SRC="transition-insert.png" WIDTH="54" HEIGHT="64"></TD>
  </TR>
</TABLE>
<P>
The first line of all transitions shows the next state. The next line contains
a set of flags where "M" =&gt; the current glyph should be marked (the meaning
of this becomes appearant later), "A" =&gt; processing should advance to
the next glyph. For indic tables there is a third flag shown, "L" =&gt; the
current glyph is the last glyph of the indic rearrangement.
<P>
The last two lines have varied meanings depending on the type of the state
machine.
<UL>
  <LI>
    For Indic transitions the two lines should be appended to get the indic
    rearrangement verb (in the example above that would be "Ax =&gt; xA" meaning
    that the first glyph marked should be moved after the last glyph marked)
  <LI>
    For contextual transitions the two lines specify the names (as 4 character
    tags) of nested substitutions. The first one is applied to the last glyph
    marked and the second one to the current glyph (if a line is blank, no
    substitution is applied to that glyph here).
  <LI>
    For insertion transitions the lines specify the glyphs that are to be inserted.
    The first line applies to the marked glyph, the second line to current glyph
    (there may not be room enough to show all the inserted glyphs, in which case
    the glyph list is truncated). There are additional flags here that are also
    not shown because of lack of room. They may be viewed by clicking on a
    transition.
</UL>
<H2>
  Editing <A NAME="EditTransition">Transitions</A>
</H2>
<P>
To edit a transition, simply click on it and a dialog will pop up, appropriate
to the type of state machine.
<TABLE BORDER CELLPADDING="2">
  <TR>
    <TH>Indic</TH>
    <TH>Contextual</TH>
    <TH>Insertion</TH>
  </TR>
  <TR>
    <TD><P ALIGN=Center>
      <IMG SRC="edittransition-indic.png" WIDTH="282" HEIGHT="337"></TD>
    <TD><P ALIGN=Center>
      <IMG SRC="edittransition-context.png" WIDTH="282" HEIGHT="337"></TD>
    <TD><P ALIGN=Center>
      <IMG SRC="edittransition-insert.png" WIDTH="282" HEIGHT="337"></TD>
  </TR>
</TABLE>
<P>
See <A HREF="statemachine.html#transitions">above</A> for a description of
what the fields mean.
<P>
If you wish to add a new state, simply edit a transition so that its next
state field is the state number desired. PfaEdit will automatically create
the state for you.
<H2>
  <A NAME="EditClass">Classes</A>
</H2>
<P>
<IMG SRC="statemachine-class.png" WIDTH="490" HEIGHT="587" ALT="Adding a class to the state machine dialog"
    ALIGN="Right">If you wish to add a new class press the [New] button under
the list of classes. If you wish to edit a class double click on that class.
The dialog should change to be like the one at right. The text field contains
a list of the names of the glyphs in this class. Pressing the [Set] button
will set that field to any selected glyphs in the font view. Pressing the
[Select] button will change the selection in the font view to match the glyphs
in the text.<BR Clear=ALL>
<UL>
  <LI>
    <A HREF="http://developer.apple.com/fonts/TTRefMan/RM06/Chap6morx.html">The
    'morx' (extended glyph metamorphisis) table</A>
  <LI>
    <A HREF="http://developer.apple.com/fonts/TTRefMan/RM06/Chap6mort.html">The
    'mort' (older version of 'morx') table</A>
  <LI>
    <A HREF="http://developer.apple.com/fonts/TTRefMan/RM06/Chap6feat.html">The
    'feat' (feature) table</A>
  <LI>
    <A HREF="http://developer.apple.com/fonts/Registry/index.html">Apple's Font
    Feature registry</A>
  <LI>
    <A HREF="http://developer.apple.com/fonts/TTRefMan/RM06/Chap6Tables.html">Description
    of the subtables of the 'mort'/'morx' tables</A>
</UL>
<P>
<P ALIGN=Center>
-- <A HREF="fontinfo.html">Up</A> -- <A HREF="overview.html">TOC</A> --
</BODY></HTML>
