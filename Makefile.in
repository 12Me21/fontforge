prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
libdir = @libdir@
mandir = @mandir@
includedir = @includedir@
sharedir = $(prefix)/share/fontforge

srcdir = @srcdir@
top_builddir = .

LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@

all: fontforge

libs: libgunicode libgdraw

fontforge: libgunicode libgdraw
	( cd fontforge ; $(MAKE) )

libgunicode:
	( cd Unicode ; $(MAKE) )

libgdraw:
	( cd gdraw ; $(MAKE) )

clean:
	( cd fontforge ; $(MAKE) clean )
	( cd Unicode ; $(MAKE) clean )
	( cd gdraw ; $(MAKE) clean )
	-rm -rf .libs

distclean cleaner:
	( cd fontforge ; $(MAKE) distclean )
	( cd Unicode ; $(MAKE) distclean )
	( cd gdraw ; $(MAKE) distclean )
	-rm -rf .libs
	-rm Makefile config.cache config.log config.status libtool

install_libs: libs
# You may need to be root to do the install
	mkdir -p $(libdir)
	#-rm $(libdir)/libgdraw.so* $(libdir)/libgunicode.so.*
	$(LIBTOOL) $(INSTALL) -c libgdraw.la $(libdir)/libgdraw.la
	$(LIBTOOL) $(INSTALL) -c libgunicode.la $(libdir)/libgunicode.la
	#cp .libs/*.so.*.* $(libdir)
	$(LIBTOOL) --finish $(libdir)
	mkdir -p $(libdir)/pkgconfig
	$(LIBTOOL) $(INSTALL) -c fontforge.pc $(libdir)/pkgconfig

install: $(sharedir) all install_libs
# You may need to be root to do the install
	mkdir -p $(bindir)
	mkdir -p $(mandir)/man1
	mkdir -p $(sharedir)
	$(LIBTOOL) $(INSTALL) -c fontforge/fontforge $(bindir)
	$(LIBTOOL) $(INSTALL) -c fontforge/sfddiff $(bindir)
	-rm -f $(bindir)/pfaedit
	(cd $(bindir) ; ln -s fontforge pfaedit)
	cp fontforge/pfaedit-*.ui $(sharedir)
#The next line will fail for most installs. If you have downloaded the cidmaps
# this will install them. If you haven't it won't. You only need the cidmaps
# if you are editing CID keyed files (and even then you can live without them
	-cp $(srcdir)/cidmap/*.cidmap $(sharedir) >/dev/null 2>&1
	cp $(srcdir)/fontforge/fontforge.1 $(mandir)/man1
	cp $(srcdir)/fontforge/sfddiff.1 $(mandir)/man1

uninstall:
	-rm $(bindir)/fontforge
	-rm $(bindir)/sfddiff
	-rm $(sharedir)/pfaedit-*.ui
	-rm $(mandir)/man1/fontforge.1
	-rm $(mandir)/man1/sfddiff.1
	-rm $(libdir)/libgdraw.so*
	-rm $(libdir)/libgunicode.so*
	-rm $(sharedir)/*.cidmap

$(sharedir):
	mkdir -p $(sharedir)
