sharedir = @prefix@/share/fontforge
srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
prefix = @prefix@
bindir = @bindir@

CC = @CC@

X_CFLAGS = @X_CFLAGS@
X_LIBS = @X_LIBS@
X_11LIB = @X_11LIB@
X_EXTRA_LIBS = @X_EXTRA_LIBS@
X_PRE_LIBS = @X_PRE_LIBS@
STATIC_LIBS = @STATIC_LIBS@

fontforge_OBJECTS =  autohint.o autosave.o autowidth.o bitmapdlg.o \
 bitmapview.o bvedit.o charview.o charviewicons.o cursors.o \
 cvaddpoints.o cvexport.o cvgetinfo.o cvhints.o cvimages.o cvknife.o \
 cvpalettes.o cvpointer.o cvruler.o cvshapes.o cvstroke.o cvtranstools.o \
 cvundoes.o dumpbdf.o dumppfa.o fontinfo.o fontview.o fvcomposit.o \
 fvfonts.o fvimportbdf.o fvmetrics.o images.o metricsview.o \
 parsepfa.o parsettf.o prefs.o psread.o psunicodenames.o savefontdlg.o \
 sfd.o splashimage.o splinefill.o splineoverlap.o splinesave.o \
 splinesaveafm.o splinestroke.o splineutil.o splineutil2.o stamp.o \
 start.o tottf.o transform.o uiutil.o utils.o windowmenu.o  \
 zapfnomen.o othersubrs.o autotrace.o openfontdlg.o encoding.o print.o \
 problems.o pfaedit-ui.o metafont.o alignment.o parsettfbmf.o \
 macbinary.o crctab.o scripting.o freetype.o gotodlg.o search.o \
 combinations.o tilepath.o sftextfield.o displayfonts.o ikarus.o \
 cvhand.o cvfreehand.o simplifydlg.o winfonts.o tottfgpos.o tottfaat.o \
 charinfo.o splineorder2.o genttfinstrs.o ttfinstrs.o cvgridfit.o \
 cvdebug.o showatt.o kernclass.o nonlineartrans.o effects.o \
 histograms.o ttfspecial.o svg.o parsettfatt.o contextchain.o \
 macenc.o statemachine.o typofeatures.o splinerefigure.o mm.o \
 parsettfvar.o tottfvar.o pua.o
DIFFOBJS = sfddiff.o sfd.o diffstubs.o stamp.o
ACORNOBJS = acorn2sfd.o sfd.o diffstubs.o psunicodenames.o stamp.o

_CFLAGS = -I$(top_srcdir)/inc -I$(srcdir) -I. @WFLAGS@ $(X_CFLAGS) \
    @DEFS@ '-DSHAREDIR="$(sharedir)"' -DLIBDIR='"$(libdir)"'
CFLAGS = @CFLAGS@ @CPPFLAGS@ $(_CFLAGS)

LDFLAGS = @LDFLAGS@
LIBS = -L../libs $(X_LIBS) ../libs/libgdraw.a ../libs/libgunicode.a \
    $(X_PRE_LIBS) $(X_11LIB) $(X_EXTRA_LIBS) @LIBS@ $(STATIC_LIBS) -lm
DLIBS = ../libs/libgunicode.a @LIBS@ -lm

all: pfaedit-en.ui fontforge sfddiff

fontforge: nomen.h $(fontforge_OBJECTS)
	$(CC) -o fontforge $(fontforge_OBJECTS) $(LIBS)

sfddiff: $(DIFFOBJS)
	$(CC) -o sfddiff $(DIFFOBJS) $(DLIBS)

acorn2sfd: $(ACORNOBJS)
	$(CC) -o acorn2sfd $(ACORNOBJS) $(DLIBS)

# The slight error introduced occasionally by optimization turns out to have
# disasterous effects. This file may not be compiled with the optimizer.
splinerefigure.o: splinerefigure.c
	$(CC) -g -c -o splinerefigure.o $(_CFLAGS) splinerefigure.c

#this makes all the .ui files but wildcarding doesn't work too well if the
# files don't exist.
nomen.h pfaedit-ui.c pfaedit-en.ui: $(srcdir)/nomen-*.c makenomenh.c
	$(CC) -o makenomenh $(CFLAGS) $(srcdir)/makenomenh.c $(LIBS)
	-ln -s $(srcdir)/nomen-*.c .
	./makenomenh
	mv pfaedit-ui-en.c pfaedit-ui.c

clean:
	-rm -f *.o fontforge *.ui nomen.h pfaedit-ui.c makenomenh _nomen-*.c sfddiff acorn2sfd

distclean cleaner: clean
	-rm -f Makefile
	-for i in nomen.*.c; do \
	  test -L $$i && rm $$i; \
	done;
